# IP
忌强行背诵 Ip-Header
理解协议的本质 是 通讯过程的抽象
尝试拟合出一个 IP构造的过程

内核路由表
route -n
ip route -n

### 通讯角度看IP
1. 分辨通讯者
2. 分片重组 (包ID, sub包的偏移)
3. 数据长度
4. 安全问题 (校验和, 仅校验首部)
5. 生命时间
6. 当前协议 (协议版本, 区分服务)
7. 下级协议 (这属于TCP/IP网络栈特有)

IP寻址: 5类网络 子网掩码 广播地址 组播地址 CIDR
时间: TTL
校验: 

+ 私有地址 不存在于互联网
+ A类：0~127   首位为0    (0 0000 000, 0 1111 111)
    + 127.x loop
    + 10.x  私有地址
    + 政府
+ B类：128~191 首位为10   (10 000 000, 10 111 111)
    + 172.16.0.0 ~ 172.31.255.255 私有地址
    + 169.254.x.x    保留地址
+ C类：192~223 首位为110  (110 00 000, 110 11 111)
    + 192.0.0.1 ~ 223.255.255.254
    + 192.168.X.X 私有地址
    + 个人/企业
+ D类：224~239 首位为1110 (1110 0000, 1110 1111) 
    + 224.0.0.0~239.255.255.255
    + 一般只用于 组播/广播
+ E类：240~255 首位为1111 (1111 0000, 1111 1111)
    + 试验阶段

掩码是为了 使得IP网段不受制于 A-E类型
掩码出现前 A-E分别固定 前n-bits表示网段

### 分片重组
+ id + offset + flags
id:     16 bits,
offset: 13 bits,  值为已装载的 bytes / 8
flags:  (3 bits), 保留|是否分片|是否末尾 (分包标志 至少需要 2-bits)

### unicast/broadcast/multicast
+ broadcast mac-dest-addr: FF-FF-FF-FF-FF-FF
    + A类 IP: xxx.255.255.255
    + B类 IP: xxx.xxx.255.255 所有子网
    + 所有子网 IP: xxx.xxx.yyy.255
    + 必须在同一子网 不能跨路由 (路由器不转发 跨网段的广播包)
+ multicast mac-dest-addr: 最高位为01 (01-xx..)
    + IP 规定是D类IP: 224.0.0.0 - 239.255.255.255
    + 既可以穿透路由器，又可以实现只给那些必要的组发送数据包
+ unicast
    + 直连 mac & ip 均为目标host
    + 经过路由 mac 为路由器 ip为目标host
一个网卡的broadcast 有什么用? 何时发生作用?
    when本机send dst-ip == broadcast, 不查询arp表, 构造链路层广播包, dst-Mac: ff-ff-...
    when本机recv dst-ip == broadcast, 即使不同于 网卡的ip, 不discard, 而是 进行后续response
